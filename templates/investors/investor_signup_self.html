<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Investor Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-card {
            max-width: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-10 mt-5">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0">
                        <i class="bi bi-person-plus"></i> Register Yourself as Investor
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" id="myForm" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <h5 class="text-primary mb-3">Personal Information</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">{{ form.full_name.label }} <span class="text-danger">*</span></label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}<div class="text-danger small">{{ form.full_name.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.email.label }} <span class="text-danger">*</span></label>
                                {{ form.email }}
                                {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.mobile.label }} <span class="text-danger">*</span></label>
                                {{ form.mobile }}
                                {% if form.mobile.errors %}<div class="text-danger small">{{ form.mobile.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.dob.label }} <span class="text-danger"></span></label>
                                {{ form.dob }}
                                {% if form.dob.errors %}<div class="text-danger small">{{ form.dob.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.profession.label }}</label>
                                {{ form.profession }}
                                {% if form.profession.errors %}<div class="text-danger small">{{ form.profession.errors }}</div>{% endif %}
                            </div>
                             <div class="col-md-12">
                                <label class="form-label">{{ form.address.label }} <span class="text-danger"></span></label>
                                {{ form.address }}
                                {% if form.address.errors %}<div class="text-danger small">{{ form.address.errors }}</div>{% endif %}
                            </div>                           
                        </div>

                        <hr class="my-4">

                        <h5 class="text-primary mb-3">KYC Information</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.pan.label }} <span class="text-danger"></span></label>
                                {{ form.pan }}
                                {% if form.pan.errors %}<div class="text-danger small">{{ form.pan.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.aadhaar.label }} <span class="text-danger"></span></label>
                                {{ form.aadhaar }}
                                {% if form.aadhaar.errors %}<div class="text-danger small">{{ form.aadhaar.errors }}</div>{% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="text-primary mb-3">Investment Philosophy</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.risk_appetite.label }}</label>
                                {{ form.risk_appetite }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.preferred_duration.label }}</label>
                                {{ form.preferred_duration }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.ticket_size_preference.label }}</label>
                                {{ form.ticket_size_preference }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.preferred_industries.label }}</label>
                                <small class="text-muted d-block mb-2">Drag to reorder by priority (Top = Highest Priority)</small>
                                
                                <!-- Hidden input to store the ordered list -->
                                {{ form.preferred_industries }}
                                
                                <!-- Draggable list container -->
                                <div id="industries-sortable-list" class="list-group" data-initial-value="{{ form.preferred_industries.value|default:'[]' }}">
                                    <!-- Items will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="text-primary mb-3">Bank & Demat Details</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">{{ form.bank_name.label }}</label>
                                {{ form.bank_name }}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.account_number.label }}</label>
                                {{ form.account_number }}
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">{{ form.ifsc_code.label }}</label>
                                {{ form.ifsc_code }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.dp_id.label }}</label>
                                {{ form.dp_id }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.client_id.label }}</label>
                                {{ form.client_id }}
                            </div>
                        </div>
                        <hr class="my-4">
                        <div class="mt-4 d-flex justify-content-between">
                            <a href="{% url 'investors:investor_list' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bi bi-check-circle"></i> Save Investor
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Preferred Industries Drag-and-Drop
            initializeIndustriesSortable();
        });
        
        function initializeIndustriesSortable() {
            const hiddenInput = document.getElementById('id_preferred_industries');
            const sortableList = document.getElementById('industries-sortable-list');
            
            if (!hiddenInput || !sortableList) return;
            
            // All available industries in default order (from model)
            const allIndustries = [
                'Technology',
                'Healthcare',
                'Finance',
                'Real Estate',
                'Consumer Goods',
                'Energy',
                'Others'
            ];
            
            // Get current order from data attribute (set by Django template)
            let currentOrder = [];
            try {
                // Read from data attribute instead of hidden input value for reliability
                const initialValue = sortableList.dataset.initialValue;
                
                if (initialValue && initialValue !== '[]' && initialValue !== 'None') {
                    // Determine if the value is wrapped in quotes (stringified JSON)
                    // or if it needs parsing
                    if (typeof initialValue === 'string') {
                         // Sometimes Django template renders with surrounding quotes
                         // We need to parse strict JSON
                         try {
                            if (initialValue.startsWith('"') && initialValue.endsWith('"')) {
                                // Double encoded
                                currentOrder = JSON.parse(JSON.parse(initialValue));
                            } else {
                                currentOrder = JSON.parse(initialValue);
                            }
                         } catch(e) {
                            // Fallback if parsing fails (maybe single quotes?)
                            // For simple list of strings, we can try to be resilient
                            console.warn("JSON parse failed, trying fallback", e);
                         }
                    }
                }
            } catch (e) {
                console.error('Error parsing preferred industries:', e);
            }
            
            // If no current order, use default order
            if (!currentOrder || currentOrder.length === 0) {
                currentOrder = [...allIndustries];
            }
            
            // Populate the sortable list
            sortableList.innerHTML = '';
            currentOrder.forEach((industry) => {
                const item = createIndustryItem(industry);
                sortableList.appendChild(item);
            });
            
            // Initialize SortableJS
            const sortable = Sortable.create(sortableList, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                handle: '.drag-handle',
                onEnd: function() {
                    updateHiddenInput();
                }
            });
            
            // Function to create an industry list item
            function createIndustryItem(industry) {
                const div = document.createElement('div');
                div.className = 'list-group-item d-flex align-items-center';
                div.style.cursor = 'move';
                div.dataset.industry = industry;
                
                div.innerHTML = `
                    <span class="drag-handle me-3" style="cursor: grab;">
                        <i class="bi bi-grip-vertical fs-5"></i>
                    </span>
                    <span class="flex-grow-1">${industry}</span>
                `;
                
                return div;
            }
            
            // Function to update hidden input with current order
            function updateHiddenInput() {
                const items = sortableList.querySelectorAll('.list-group-item');
                const orderedIndustries = [];
                
                items.forEach((item) => {
                    const industry = item.dataset.industry;
                    orderedIndustries.push(industry);
                });
                
                // Update hidden input
                hiddenInput.value = JSON.stringify(orderedIndustries);
            }
            
            // Initial update of hidden input
            updateHiddenInput();
        }
    </script>
    
    <style>
        /* Sortable.js visual feedback styles */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #f8f9fa;
        }
        
        .sortable-chosen {
            background-color: #e7f3ff;
            border-color: #0d6efd;
        }
        
        .sortable-drag {
            opacity: 0.8;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .drag-handle:active {
            cursor: grabbing !important;
        }
        
        #industries-sortable-list .list-group-item {
            transition: all 0.2s ease;
        }
        
        #industries-sortable-list .list-group-item:hover {
            background-color: #f8f9fa;
            border-color: #0d6efd;
        }
    </style>
</body>
</html>

